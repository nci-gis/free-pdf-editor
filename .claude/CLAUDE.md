# Free PDF Editor - Project Context

## Overview

A lightweight, fully client-side PDF editor built with Svelte. All functionality runs directly in the browser with no backend, no uploads, and no tracking. The project prioritizes simplicity, offline usage, and ease of static deployment.

## Tech Stack

| Layer            | Technology                                 |
| ---------------- | ------------------------------------------ |
| Framework        | Svelte 5                                   |
| Build            | Rollup + rollup-plugin-copy                |
| Styling          | Tailwind CSS 1.9.6 + PostCSS               |
| PDF Rendering    | pdf.js (src/vendor → public/assets/vendor) |
| PDF Manipulation | pdf-lib (src/vendor → public/assets/vendor)|
| Package Manager  | pnpm                                       |

## Project Structure

```text
src/
├── main.js                 # Application entry point
├── App.svelte              # Root component with main state management
├── assets/
│   ├── fonts/
│   │   └── CK.ttf          # Chinese font (copied to public/assets/fonts/)
│   └── icons/              # SVG icons as Svelte components
│       ├── DeleteIcon.svelte
│       ├── LineHeightIcon.svelte
│       ├── TextIcon.svelte
│       └── TextFamilyIcon.svelte
├── components/
│   ├── PDFPage.svelte      # PDF page rendering
│   ├── Text.svelte         # Text annotation component
│   ├── Image.svelte        # Image insertion/editing
│   ├── Drawing.svelte      # Drawing annotation display
│   ├── DrawingCanvas.svelte # Drawing canvas for freehand
│   ├── DropZone.svelte     # File upload/drag-drop UI
│   ├── Toast.svelte        # Notification component
│   └── Tailwind.svelte     # Tailwind CSS loader
├── config/
│   └── assets.js           # Centralized asset path configuration
├── utils/
│   ├── PDF.js              # PDF save functionality
│   ├── asyncReader.js      # File reading utilities
│   ├── prepareAssets.js    # Asset/library lazy loading
│   ├── helper.js           # Helper functions (ggID, timeout, etc.)
│   ├── pannable.js         # Drag/pan Svelte action
│   ├── tapout.js           # Click-outside Svelte action
│   └── recentFiles.js      # LocalStorage for recent files
└── vendor/                 # Source vendor libraries (copied to public/)
    ├── pdf.min.js
    ├── pdf-lib.min.js
    ├── download.min.js
    └── makeTextPDF.js
public/
├── index.html              # HTML entry point
├── assets/                 # Generated by rollup-plugin-copy
│   ├── fonts/              # Copied from src/assets/fonts/
│   └── vendor/             # Copied from src/vendor/
├── build/                  # Compiled output (generated)
├── favicon.ico
└── test.pdf
```

## Development Commands

```bash
pnpm install    # Install dependencies
pnpm dev        # Start dev server with hot reload (http://localhost:8080)
pnpm build      # Production build to public/build/
pnpm start      # Serve public/ directory
```

## Architecture Patterns

### State Management

- App.svelte maintains global state: `pages`, `allObjects`, `selectedPageIndex`, `pdfFile`
- `allObjects` is a 2D array where each page has its own array of annotations
- Annotations are objects with `type`, `x`, `y`, `width`, `height`, and type-specific properties

### Custom Svelte Actions

- `pannable.js` - Mouse/touch drag events (panstart, panmove, panend)
- `tapout.js` - Click-outside detection for deselecting elements

### Asset Loading

- **Source of truth**: All assets live in `src/` (vendor libs, fonts)
- **Build pipeline**: `rollup-plugin-copy` copies assets from `src/` to `public/assets/`
- **Path configuration**: Centralized in `src/config/assets.js`
- **Lazy loading**: `prepareAssets.js` dynamically loads vendor scripts at runtime
- **SVG icons**: Converted to Svelte components (inlined in bundle, no HTTP requests)
- **Fonts**: Built-in support for Courier, Helvetica, Times-Roman, 標楷體 (Chinese)

### PDF Processing Flow

1. User drops/selects PDF → `readAsPDF()` parses with pdf.js
2. Pages rendered as canvas elements via `PDFPage.svelte`
3. Annotations overlaid as draggable Svelte components
4. Save: pdf-lib embeds images/text/drawings into original PDF

## Code Conventions

### Svelte Components

- Use Svelte 5 runes syntax when modifying components
- Component files use PascalCase (e.g., `PDFPage.svelte`)
- Event dispatching via `createEventDispatcher()`

### Styling

- Use Tailwind utility classes
- Avoid inline styles unless dynamic
- Custom CSS goes in component `<style>` blocks (scoped)

### File Operations

- All file I/O uses browser APIs (FileReader, Blob, etc.)
- No Node.js file system operations
- LocalStorage for persistence (recent files)

## Important Constraints

### Client-Side Only

- **Never** add backend dependencies or server-side code
- All processing must happen in the browser
- No external API calls for core functionality

### Privacy First

- No analytics, tracking, or telemetry
- No file uploads to external servers
- PDFs never leave the user's machine

### Static Deployment

- Output must work when served as static files
- No build-time environment variables for runtime features
- Support direct file:// protocol opening in Chrome/Edge

## Testing & Debugging

### Manual Testing

1. Run `pnpm dev`
2. Open <http://localhost:8080>
3. Test with `public/test.pdf` or your own PDFs

### Common Issues

- **Assets not found**: Run `pnpm build` to copy assets from src/ to public/assets/
- **Font loading**: Check `src/config/assets.js` font paths
- **PDF not rendering**: Verify pdf.js exists in src/vendor/ and build ran
- **Save not working**: Check pdf-lib and download.min.js in src/vendor/

## Key Files to Understand

| File                                           | Purpose                              |
| ---------------------------------------------- | ------------------------------------ |
| [App.svelte](src/App.svelte)                   | Main application logic and state     |
| [PDF.js](src/utils/PDF.js)                     | PDF save/export functionality        |
| [prepareAssets.js](src/utils/prepareAssets.js) | Lazy loading external libraries      |
| [assets.js](src/config/assets.js)              | Centralized asset path configuration |
| [asyncReader.js](src/utils/asyncReader.js)     | File reading utilities               |
| [rollup.config.js](rollup.config.js)           | Build config with asset copy plugin  |

## Git Workflow

- Main branch: `dev`
- Commit messages: Use conventional commits (feat:, fix:, docs:, etc.)
- Keep changes client-side only
